/**
 * scriptAST.js - Vue Script ä»£ç æçº¯å·¥å…·
 *
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 * ğŸ¯ æ ¸å¿ƒåŠŸèƒ½ï¼šä» Vue ç»„ä»¶çš„ Script ä¸­æå–ä¸ç›®æ ‡å˜é‡ç›¸å…³çš„ä»£ç 
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 *
 * ğŸ“š æŠ€æœ¯èƒŒæ™¯ï¼šä»€ä¹ˆæ˜¯ä»£ç æçº¯ï¼Ÿ
 *
 * ä¸€ä¸ª Vue ç»„ä»¶å¯èƒ½æœ‰ 2000+ è¡Œä»£ç ï¼Œä½†ç”¨æˆ·ç‚¹å‡»çš„é‚£ä¸ªå˜é‡å¯èƒ½åªæ¶‰åŠ 50 è¡Œã€‚
 * å¦‚æœæŠŠ 2000 è¡Œå…¨éƒ¨å‘ç»™ AI åˆ†æï¼Œä¼šï¼š
 * - æµªè´¹ Tokenï¼ˆè´¹é’±ï¼‰
 * - å¹²æ‰° AI åˆ¤æ–­ï¼ˆå™ªéŸ³å¤ªå¤šï¼‰
 * - å“åº”å˜æ…¢
 *
 * ä»£ç æçº¯å°±æ˜¯åªä¿ç•™ä¸ç›®æ ‡å˜é‡ç›¸å…³çš„ä»£ç ï¼Œå‰”é™¤æ— å…³é€»è¾‘ã€‚
 *
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 *
 * ğŸ“Š æçº¯å‰åå¯¹æ¯”ç¤ºä¾‹ï¼š
 *
 *   ã€æçº¯å‰ã€‘å®Œæ•´ç»„ä»¶ä»£ç ï¼ˆç®€åŒ–ç¤ºä¾‹ï¼‰ï¼š
 *   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 *   â”‚  export default {                                          â”‚
 *   â”‚    name: 'Dashboard',                                      â”‚
 *   â”‚    components: { ChartCard, UserList },  // âŒ æ— å…³        â”‚
 *   â”‚    i18n: { ... },                        // âŒ æ— å…³        â”‚
 *   â”‚    props: {                                                â”‚
 *   â”‚      userId: String,                     // âŒ æ— å…³        â”‚
 *   â”‚      amount: Number,                     // âœ… ç›®æ ‡å˜é‡    â”‚
 *   â”‚    },                                                      â”‚
 *   â”‚    data() {                                                â”‚
 *   â”‚      return {                                              â”‚
 *   â”‚        loading: false,                   // âŒ æ— å…³        â”‚
 *   â”‚        error: null,                      // âŒ æ— å…³        â”‚
 *   â”‚      }                                                     â”‚
 *   â”‚    },                                                      â”‚
 *   â”‚    computed: {                                             â”‚
 *   â”‚      formattedAmount() {                 // âœ… ä½¿ç”¨äº†ç›®æ ‡  â”‚
 *   â”‚        return 'Â¥' + this.amount;                           â”‚
 *   â”‚      },                                                    â”‚
 *   â”‚      userName() { ... },                 // âŒ æ— å…³        â”‚
 *   â”‚    },                                                      â”‚
 *   â”‚    methods: {                                              â”‚
 *   â”‚      handleClick() { ... },              // âŒ æ— å…³        â”‚
 *   â”‚    }                                                       â”‚
 *   â”‚  }                                                         â”‚
 *   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 *
 *   ã€æçº¯åã€‘åªä¿ç•™ç›¸å…³ä»£ç ï¼š
 *   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 *   â”‚  export default {                                          â”‚
 *   â”‚    name: 'Dashboard',                                      â”‚
 *   â”‚    props: {                                                â”‚
 *   â”‚      amount: Number,                                       â”‚
 *   â”‚    },                                                      â”‚
 *   â”‚    computed: {                                             â”‚
 *   â”‚      formattedAmount() {                                   â”‚
 *   â”‚        return 'Â¥' + this.amount;                           â”‚
 *   â”‚      },                                                    â”‚
 *   â”‚    },                                                      â”‚
 *   â”‚  }                                                         â”‚
 *   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 *
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 *
 * ğŸ“Š æ ¸å¿ƒç®—æ³•ï¼šBFS ä¾èµ–è¿½è¸ª
 *
 *   ä»ç›®æ ‡å˜é‡å‡ºå‘ï¼Œå¹¿åº¦ä¼˜å…ˆæœç´¢æ‰€æœ‰ç›¸å…³çš„ä»£ç ï¼š
 *
 *   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 *   â”‚                                                             â”‚
 *   â”‚   ç›®æ ‡å˜é‡: amount                                          â”‚
 *   â”‚        â”‚                                                    â”‚
 *   â”‚        â–¼                                                    â”‚
 *   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    å‘ç°å¼•ç”¨äº† amount                          â”‚
 *   â”‚   â”‚ amount  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º  formattedAmount      â”‚
 *   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          (åŠ å…¥é˜Ÿåˆ—)           â”‚
 *   â”‚                                             â”‚               â”‚
 *   â”‚                                             â–¼               â”‚
 *   â”‚                                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
 *   â”‚                                   â”‚ formattedAmount  â”‚      â”‚
 *   â”‚                                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
 *   â”‚                                             â”‚               â”‚
 *   â”‚                                             â–¼               â”‚
 *   â”‚                                   æ²¡æœ‰æ›´å¤šä¾èµ–ï¼Œç»“æŸ         â”‚
 *   â”‚                                                             â”‚
 *   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 *
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 */

const { parseCode, traverseAST, generateCode } = require('./utils/astUtils');
const {
  SCRIPT_VARIABLE_BLACKLIST,
  FILTERED_COMPONENT_PROPERTIES,
  PRESERVED_IMPORT_KEYWORDS,
  GENERIC_VARIABLE_NAMES
} = require('./utils/astConfig');

/**
 * åˆ¤æ–­æ ‡è¯†ç¬¦æ˜¯å¦åœ¨é»‘åå•ä¸­
 * @param {string} name - æ ‡è¯†ç¬¦åç§°
 * @returns {boolean} æ˜¯å¦åœ¨é»‘åå•
 *
 * ğŸ“ ä¸ºä»€ä¹ˆéœ€è¦é»‘åå•ï¼Ÿ
 *
 * æœ‰äº›å˜é‡åå¤ªé€šç”¨äº†ï¼Œè¿½è¸ªå®ƒä»¬ä¼šå¼•å…¥å¤§é‡æ— å…³ä»£ç ï¼š
 * - res / dataï¼šå‡ ä¹æ¯ä¸ª API å›è°ƒéƒ½æœ‰
 * - item / indexï¼šv-for çš„ä¸´æ—¶å˜é‡
 * - e / eventï¼šäº‹ä»¶å¤„ç†å‡½æ•°çš„å‚æ•°
 *
 * è¿™äº›å˜é‡ä¸éœ€è¦è¿½è¸ªï¼Œç›´æ¥è·³è¿‡ã€‚
 */
function isBlacklisted(name) {
  // å…ˆæ£€æŸ¥é…ç½®æ–‡ä»¶ä¸­çš„é»‘åå•
  if (SCRIPT_VARIABLE_BLACKLIST.has(name)) {
    return true;
  }

  // é¢å¤–çš„ç¡¬ç¼–ç é»‘åå•ï¼ˆå¸¸è§çš„å…¨å±€å¯¹è±¡å’Œå·¥å…·å‡½æ•°ï¼‰
  const additionalBlacklist = [
    'console',    // æ—¥å¿—è¾“å‡º
    'mapState',   // Vuex è¾…åŠ©å‡½æ•°
    'request',    // HTTP è¯·æ±‚å·¥å…·
    'METHOD',     // è¯·æ±‚æ–¹æ³•å¸¸é‡
    'require',    // CommonJS å¯¼å…¥
    'Math',       // æ•°å­¦å·¥å…·
  ];

  return additionalBlacklist.includes(name);
}

/**
 * æ•è·èŠ‚ç‚¹åŠå…¶ä¾èµ–çš„å˜é‡
 * @param {Object} path - Babel path å¯¹è±¡
 * @param {Set} keptNodes - ä¿ç•™çš„èŠ‚ç‚¹é›†åˆ
 * @param {Set} visitedVars - å·²è®¿é—®çš„å˜é‡é›†åˆ
 * @param {Array} queue - å¾…å¤„ç†çš„å˜é‡é˜Ÿåˆ—ï¼ˆBFS é˜Ÿåˆ—ï¼‰
 *
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 * ğŸ“ Babel Path æ˜¯ä»€ä¹ˆï¼Ÿ
 *
 * Babel éå† AST æ—¶ï¼Œä¸æ˜¯ç›´æ¥ç»™ä½ èŠ‚ç‚¹ï¼Œè€Œæ˜¯ç»™ä½ ä¸€ä¸ª "path" å¯¹è±¡ã€‚
 * path åŒ…å«ï¼š
 * - path.nodeï¼šå½“å‰èŠ‚ç‚¹
 * - path.parentï¼šçˆ¶èŠ‚ç‚¹
 * - path.traverse()ï¼šç»§ç»­éå†å­èŠ‚ç‚¹
 * - path.remove()ï¼šåˆ é™¤å½“å‰èŠ‚ç‚¹
 *
 * ğŸ“Š è¿™ä¸ªå‡½æ•°åšäº†ä»€ä¹ˆï¼Ÿ
 *
 *   1. æŠŠå½“å‰èŠ‚ç‚¹åŠ å…¥"ä¿ç•™é›†åˆ"
 *   2. éå†èŠ‚ç‚¹å†…éƒ¨çš„æ‰€æœ‰æ ‡è¯†ç¬¦ï¼ˆå˜é‡åï¼‰
 *   3. æŠŠæ–°å‘ç°çš„å˜é‡åŠ å…¥ BFS é˜Ÿåˆ—ï¼Œç»§ç»­è¿½è¸ª
 *
 *   ç¤ºä¾‹ï¼š
 *   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 *   â”‚  formattedAmount() {                       â”‚
 *   â”‚    return 'Â¥' + this.amount;  // å‘ç° amount
 *   â”‚  }                                         â”‚
 *   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 *   -> ä¿ç•™è¿™ä¸ªèŠ‚ç‚¹
 *   -> æŠŠ amount åŠ å…¥é˜Ÿåˆ—ç»§ç»­è¿½è¸ª
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 */
function captureNode(path, keptNodes, visitedVars, queue) {
  // æŠŠå½“å‰èŠ‚ç‚¹åŠ å…¥ä¿ç•™é›†åˆ
  keptNodes.add(path.node);

  // éå†èŠ‚ç‚¹å†…éƒ¨ï¼Œæ”¶é›†æ‰€æœ‰å¼•ç”¨çš„å˜é‡
  path.traverse({
    Identifier(childPath) {
      // isReferencedIdentifierï¼šåˆ¤æ–­æ˜¯å¦æ˜¯"å¼•ç”¨"è€Œé"å£°æ˜"
      // ä¾‹å¦‚ï¼šconst a = b ä¸­ï¼Œa æ˜¯å£°æ˜ï¼Œb æ˜¯å¼•ç”¨
      if (!childPath.isReferencedIdentifier()) return;

      const name = childPath.node.name;

      // è·³è¿‡é»‘åå•å˜é‡
      if (isBlacklisted(name)) return;

      // æ–°å˜é‡ï¼šåŠ å…¥å·²è®¿é—®é›†åˆå’Œ BFS é˜Ÿåˆ—
      if (!visitedVars.has(name)) {
        visitedVars.add(name);
        queue.push(name);
      }
    }
  });
}

/**
 * è¿½è¸ªä¾èµ–å…³ç³»ï¼Œæ‰¾å‡ºæ‰€æœ‰éœ€è¦ä¿ç•™çš„é¡¶å±‚èŠ‚ç‚¹
 * @param {Object} ast - AST å¯¹è±¡
 * @param {Array} targetVars - ç›®æ ‡å˜é‡åˆ—è¡¨
 * @returns {Object} { keptNodes, visitedVars }
 *
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 * ğŸ“ æ ¸å¿ƒç®—æ³•ï¼šBFSï¼ˆå¹¿åº¦ä¼˜å…ˆæœç´¢ï¼‰
 *
 * ä¸ºä»€ä¹ˆç”¨ BFS è€Œä¸æ˜¯ DFSï¼Ÿ
 * - BFS å¯ä»¥æ‰¾åˆ°"æœ€çŸ­ä¾èµ–è·¯å¾„"
 * - å±‚çº§æ›´æ¸…æ™°ï¼Œä¾¿äºç†è§£æ•°æ®æµå‘
 *
 * ğŸ“Š ç®—æ³•æµç¨‹ï¼š
 *
 *   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 *   â”‚  è¾“å…¥: targetVars = ['amount']                              â”‚
 *   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 *                           â”‚
 *                           â–¼
 *   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 *   â”‚  åˆå§‹åŒ–:                                                    â”‚
 *   â”‚  - queue = ['amount']        // BFS é˜Ÿåˆ—                    â”‚
 *   â”‚  - visitedVars = {'amount'}  // å·²è®¿é—®å˜é‡                  â”‚
 *   â”‚  - keptNodes = Set()         // ä¿ç•™çš„èŠ‚ç‚¹                  â”‚
 *   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 *                           â”‚
 *                           â–¼
 *   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 *   â”‚  While é˜Ÿåˆ—ä¸ä¸ºç©º:                                          â”‚
 *   â”‚    1. å–å‡ºé˜Ÿé¦–å˜é‡ 'amount'                                 â”‚
 *   â”‚    2. éå† ASTï¼Œæ‰¾åˆ°åŒ…å« 'amount' çš„èŠ‚ç‚¹                    â”‚
 *   â”‚    3. æŠŠè¿™äº›èŠ‚ç‚¹åŠ å…¥ keptNodes                              â”‚
 *   â”‚    4. ä»èŠ‚ç‚¹ä¸­æå–æ–°å˜é‡ï¼ŒåŠ å…¥é˜Ÿåˆ—                          â”‚
 *   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 *                           â”‚
 *                           â–¼
 *   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 *   â”‚  è¾“å‡º: { keptNodes, visitedVars }                           â”‚
 *   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 *
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 */
function trackDependencies(ast, targetVars) {
  // å¦‚æœæ²¡æœ‰ç›®æ ‡å˜é‡ï¼Œç”¨ 'name' ä½œä¸ºå…œåº•ï¼ˆè‡³å°‘ä¿ç•™ç»„ä»¶åï¼‰
  const effectiveVars = targetVars.length > 0 ? targetVars : ['name'];

  // åˆå§‹åŒ– BFS æ•°æ®ç»“æ„
  const keptNodes = new Set();              // éœ€è¦ä¿ç•™çš„ AST èŠ‚ç‚¹
  const visitedVars = new Set(effectiveVars); // å·²è®¿é—®çš„å˜é‡ï¼ˆé˜²æ­¢é‡å¤ï¼‰
  const queue = [...effectiveVars];         // BFS é˜Ÿåˆ—

  // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  // BFS ä¸»å¾ªç¯
  // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  while (queue.length > 0) {
    // å–å‡ºé˜Ÿé¦–å˜é‡
    const currVar = queue.shift();

    // éå† ASTï¼Œæ‰¾åˆ°åŒ…å«å½“å‰å˜é‡çš„èŠ‚ç‚¹
    traverseAST(ast, {
      // åŒ¹é…å¤šç§èŠ‚ç‚¹ç±»å‹ï¼ˆç”¨ | åˆ†éš”ï¼‰
      'ExportDefaultDeclaration|VariableDeclarator|ImportSpecifier|CallExpression'(path) {
        let isMatched = false;

        // åœ¨èŠ‚ç‚¹å†…éƒ¨æŸ¥æ‰¾å½“å‰å˜é‡
        path.traverse({
          // åŒ¹é…æ ‡è¯†ç¬¦ï¼ˆå˜é‡åï¼‰
          Identifier(childPath) {
            if (childPath.node.name === currVar) {
              isMatched = true;
            }
          },
          // ä¹ŸåŒ¹é…å­—ç¬¦ä¸²å­—é¢é‡ï¼ˆå¦‚ mapState(['amount'])ï¼‰
          StringLiteral(childPath) {
            if (childPath.node.value === currVar) {
              isMatched = true;
            }
          }
        });

        if (isMatched) {
          // æ‰¾åˆ°åŒ…å«è¯¥å˜é‡çš„é¡¶å±‚è¯­å¥
          // findParentï¼šå‘ä¸ŠæŸ¥æ‰¾ï¼Œç›´åˆ°æ‰¾åˆ° Program çš„ç›´æ¥å­èŠ‚ç‚¹
          const topParent = path.findParent(p => p.parentPath && p.parentPath.isProgram()) || path;

          // å¦‚æœè¿˜æ²¡ä¿ç•™è¿‡ï¼Œæ•è·è¿™ä¸ªèŠ‚ç‚¹
          if (!keptNodes.has(topParent.node)) {
            captureNode(topParent, keptNodes, visitedVars, queue);
          }
        }
      }
    });
  }

  return { keptNodes, visitedVars };
}

/**
 * åˆ¤æ–­å±æ€§æ˜¯å¦åº”è¯¥ä¿ç•™
 * @param {string} keyName - å±æ€§å
 * @param {Object} propNode - å±æ€§èŠ‚ç‚¹
 * @param {Set} visitedVars - å·²è®¿é—®çš„å˜é‡é›†åˆ
 * @returns {boolean} æ˜¯å¦ä¿ç•™
 *
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 * ğŸ“ Vue ç»„ä»¶å±æ€§è¿‡æ»¤è§„åˆ™
 *
 * Vue ç»„ä»¶çš„ export default { } é‡Œæœ‰å¾ˆå¤šå±æ€§ï¼Œæˆ‘ä»¬éœ€è¦å†³å®šä¿ç•™å“ªäº›ï¼š
 *
 * â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 * â”‚  å±æ€§ç±»å‹       â”‚  å¤„ç†æ–¹å¼                                  â”‚
 * â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 * â”‚  components     â”‚  âŒ åˆ é™¤ï¼ˆå­ç»„ä»¶æ³¨å†Œï¼Œä¸å½±å“æ•°æ®æµï¼‰       â”‚
 * â”‚  i18n           â”‚  âŒ åˆ é™¤ï¼ˆå›½é™…åŒ–é…ç½®ï¼‰                     â”‚
 * â”‚  directives     â”‚  âŒ åˆ é™¤ï¼ˆè‡ªå®šä¹‰æŒ‡ä»¤ï¼‰                     â”‚
 * â”‚  name           â”‚  âœ… ä¿ç•™ï¼ˆç»„ä»¶åï¼Œç”¨äºè°ƒè¯•ï¼‰               â”‚
 * â”‚  props          â”‚  âš¡ æ¡ä»¶ä¿ç•™ï¼ˆåªä¿ç•™ç›¸å…³çš„ propï¼‰          â”‚
 * â”‚  computed       â”‚  âš¡ æ¡ä»¶ä¿ç•™ï¼ˆåªä¿ç•™ç›¸å…³çš„è®¡ç®—å±æ€§ï¼‰       â”‚
 * â”‚  methods        â”‚  âš¡ æ¡ä»¶ä¿ç•™ï¼ˆåªä¿ç•™ç›¸å…³çš„æ–¹æ³•ï¼‰           â”‚
 * â”‚  data           â”‚  âš¡ æ¡ä»¶ä¿ç•™ï¼ˆåªä¿ç•™ç›¸å…³çš„æ•°æ®ï¼‰           â”‚
 * â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 */
function shouldKeepProperty(keyName, propNode, visitedVars) {
  // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  // è§„åˆ™1ï¼šå¿…æ€åå•ï¼ˆæ— æ¡ä»¶åˆ é™¤ï¼‰
  // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  // è¿™äº›å±æ€§ä¸å½±å“æ•°æ®æµåˆ†æï¼Œç›´æ¥åˆ é™¤
  if (FILTERED_COMPONENT_PROPERTIES.has(keyName)) {
    return false;
  }

  // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  // è§„åˆ™2ï¼šç»„ä»¶åå¿…ç•™
  // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  // ç»„ä»¶åç”¨äºè°ƒè¯•å’Œé”™è¯¯æç¤ºï¼Œå§‹ç»ˆä¿ç•™
  if (keyName === 'name') {
    return true;
  }

  // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  // è§„åˆ™3ï¼šæ£€æŸ¥å±æ€§å—æ˜¯å¦åŒ…å«ä¸šåŠ¡å˜é‡
  // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  // æŠŠèŠ‚ç‚¹è½¬å›ä»£ç ï¼Œç”¨å­—ç¬¦ä¸²åŒ¹é…æ£€æŸ¥æ˜¯å¦åŒ…å«ç›®æ ‡å˜é‡
  // ğŸ“ ä¸ºä»€ä¹ˆç”¨å­—ç¬¦ä¸²åŒ¹é…è€Œä¸æ˜¯ ASTï¼Ÿ
  //    AST éå†å¤ªæ…¢ï¼Œä¸”éš¾ä»¥è¦†ç›–æ‰€æœ‰åŠ¨æ€ç»‘å®šåœºæ™¯
  //    å­—ç¬¦ä¸²åŒ¹é…ä½œä¸º"å…œåº•é€»è¾‘"å¯ä»¥æé«˜å¬å›ç‡
  const propCode = generateCode(propNode);

  const isUseful = Array.from(visitedVars).some(v =>
    // æ’é™¤é€šç”¨å˜é‡åï¼ˆå¦‚ Stringã€Numberï¼‰ï¼Œé¿å…è¯¯åŒ¹é…
    !GENERIC_VARIABLE_NAMES.has(v) && propCode.includes(v)
  );

  return isUseful;
}

/**
 * è¿‡æ»¤å¯¹è±¡å±æ€§å†…éƒ¨çš„å­å±æ€§ï¼ˆprops/computed/methodsï¼‰
 * @param {Object} propPath - å±æ€§ path
 * @param {string} keyName - å±æ€§å
 * @param {Set} visitedVars - å·²è®¿é—®çš„å˜é‡é›†åˆ
 *
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 * ğŸ“ æ·±åº¦è¿‡æ»¤ï¼šä¸ä»…åˆ é™¤æ— å…³å±æ€§ï¼Œè¿˜è¦æ·±å…¥å±æ€§å†…éƒ¨åˆ é™¤æ— å…³çš„å­é¡¹
 *
 * ğŸ“Š ç¤ºä¾‹ï¼š
 *
 *   ã€è¿‡æ»¤å‰ã€‘props åŒ…å« 3 ä¸ªå±æ€§ï¼š
 *   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 *   â”‚  props: {                                  â”‚
 *   â”‚    userId: String,    // âŒ æ— å…³           â”‚
 *   â”‚    amount: Number,    // âœ… ç›®æ ‡å˜é‡       â”‚
 *   â”‚    loading: Boolean,  // âŒ æ— å…³           â”‚
 *   â”‚  }                                         â”‚
 *   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 *
 *   ã€è¿‡æ»¤åã€‘åªä¿ç•™ç›¸å…³çš„ propï¼š
 *   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 *   â”‚  props: {                                  â”‚
 *   â”‚    amount: Number,                         â”‚
 *   â”‚  }                                         â”‚
 *   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 */
function filterSubProperties(propPath, keyName, visitedVars) {
  // åªå¤„ç† propsã€computedã€methods è¿™ä¸‰ç§å±æ€§
  if (!['props', 'computed', 'methods'].includes(keyName)) return;

  const val = propPath.get('value');

  // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  // æƒ…å†µ1ï¼šæ•°ç»„å½¢å¼çš„ props
  // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  // ç¤ºä¾‹ï¼šprops: ['userId', 'amount', 'loading']
  if (val.isArrayExpression()) {
    val.node.elements = val.node.elements.filter(el =>
      el.type === 'StringLiteral' && visitedVars.has(el.value)
    );
    return;
  }

  // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  // æƒ…å†µ2ï¼šå¯¹è±¡å½¢å¼
  // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  // ç¤ºä¾‹ï¼šprops: { amount: { type: Number } }
  // ç¤ºä¾‹ï¼šcomputed: { formattedAmount() { return ... } }
  if (val.isObjectExpression()) {
    val.get('properties').forEach(p => {
      const subName = p.node.key?.name || '';
      const subCode = generateCode(p.node);

      // åˆ¤æ–­å­å±æ€§æ˜¯å¦ä¸ç›®æ ‡å˜é‡ç›¸å…³
      const isSubUseful = visitedVars.has(subName) ||
        Array.from(visitedVars).some(v =>
          !GENERIC_VARIABLE_NAMES.has(v) && subCode.includes(v)
        );

      // æ— å…³çš„å­å±æ€§ç›´æ¥åˆ é™¤
      if (!isSubUseful) {
        p.remove();
      }
    });
  }
}

/**
 * è¿‡æ»¤ç”Ÿå‘½å‘¨æœŸé’©å­ä¸­çš„è¯­å¥ï¼ˆåªä¿ç•™ç›¸å…³è¯­å¥ï¼‰
 * @param {Object} propPath - å±æ€§ path
 * @param {string} keyName - å±æ€§å
 * @param {Set} visitedVars - å·²è®¿é—®çš„å˜é‡é›†åˆ
 *
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 * ğŸ“ ç”Ÿå‘½å‘¨æœŸé’©å­è¿‡æ»¤
 *
 * createdã€mounted ç­‰é’©å­é‡Œå¯èƒ½æœ‰å¾ˆå¤šåˆå§‹åŒ–é€»è¾‘ï¼Œ
 * ä½†æˆ‘ä»¬åªå…³å¿ƒä¸ç›®æ ‡å˜é‡ç›¸å…³çš„è¯­å¥ã€‚
 *
 * ğŸ“Š ç¤ºä¾‹ï¼š
 *
 *   ã€è¿‡æ»¤å‰ã€‘mounted é’©å­ï¼š
 *   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 *   â”‚  mounted() {                               â”‚
 *   â”‚    this.initChart();      // âŒ æ— å…³       â”‚
 *   â”‚    this.amount = 100;     // âœ… ç›¸å…³       â”‚
 *   â”‚    this.loadUserInfo();   // âŒ æ— å…³       â”‚
 *   â”‚  }                                         â”‚
 *   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 *
 *   ã€è¿‡æ»¤åã€‘åªä¿ç•™ç›¸å…³è¯­å¥ï¼š
 *   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 *   â”‚  mounted() {                               â”‚
 *   â”‚    this.amount = 100;                      â”‚
 *   â”‚  }                                         â”‚
 *   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 */
function filterLifecycleStatements(propPath, keyName, visitedVars) {
  // åªå¤„ç† created å’Œ mounted é’©å­
  if (!['created', 'mounted'].includes(keyName)) return;

  // è·å–å‡½æ•°ä½“
  // ObjectMethod: mounted() { }
  // ObjectProperty: mounted: function() { }
  const body = propPath.isObjectMethod()
    ? propPath.get('body')
    : propPath.get('value.body');

  if (body && body.isBlockStatement()) {
    // éå†å‡½æ•°ä½“ä¸­çš„æ¯æ¡è¯­å¥
    body.get('body').forEach(stmtPath => {
      const stmtCode = generateCode(stmtPath.node);

      // åˆ¤æ–­è¯­å¥æ˜¯å¦åŒ…å«ä¸šåŠ¡å˜é‡
      const hasBusinessVar = Array.from(visitedVars).some(v =>
        // æ’é™¤å¸¸è§çš„æ— å…³å˜é‡å
        !['res', 'data', 'METHOD', 'request'].includes(v) &&
        stmtCode.includes(v)
      );

      // æ— å…³è¯­å¥ç›´æ¥åˆ é™¤
      if (!hasBusinessVar) {
        stmtPath.remove();
      }
    });
  }
}

/**
 * è¿‡æ»¤ data å±æ€§ä¸­çš„å­å±æ€§
 * @param {Object} propPath - å±æ€§ path
 * @param {Set} visitedVars - å·²è®¿é—®çš„å˜é‡é›†åˆ
 *
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 * ğŸ“ data å‡½æ•°è¿‡æ»¤
 *
 * Vue çš„ data æ˜¯ä¸€ä¸ªè¿”å›å¯¹è±¡çš„å‡½æ•°ï¼Œæˆ‘ä»¬éœ€è¦æ·±å…¥åˆ° return è¯­å¥å†…éƒ¨è¿‡æ»¤ã€‚
 *
 * ğŸ“Š ç¤ºä¾‹ï¼š
 *
 *   ã€è¿‡æ»¤å‰ã€‘
 *   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 *   â”‚  data() {                                  â”‚
 *   â”‚    return {                                â”‚
 *   â”‚      loading: false,   // âŒ æ— å…³          â”‚
 *   â”‚      amount: 0,        // âœ… ç›®æ ‡å˜é‡      â”‚
 *   â”‚      userList: [],     // âŒ æ— å…³          â”‚
 *   â”‚    }                                       â”‚
 *   â”‚  }                                         â”‚
 *   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 *
 *   ã€è¿‡æ»¤åã€‘
 *   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 *   â”‚  data() {                                  â”‚
 *   â”‚    return {                                â”‚
 *   â”‚      amount: 0,                            â”‚
 *   â”‚    }                                       â”‚
 *   â”‚  }                                         â”‚
 *   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 */
function filterDataProperties(propPath, visitedVars) {
  // éå† data å‡½æ•°ï¼Œæ‰¾åˆ° return è¯­å¥
  propPath.traverse({
    ReturnStatement(retPath) {
      const arg = retPath.get('argument');

      // å¦‚æœ return çš„æ˜¯ä¸€ä¸ªå¯¹è±¡
      if (arg.isObjectExpression()) {
        // éå†å¯¹è±¡çš„æ¯ä¸ªå±æ€§
        arg.get('properties').forEach(p => {
          const dataName = p.node.key?.name || '';

          // å¦‚æœè¿™ä¸ªæ•°æ®å±æ€§ä¸åœ¨å·²è®¿é—®å˜é‡ä¸­ï¼Œåˆ é™¤å®ƒ
          if (!visitedVars.has(dataName)) {
            p.remove();
          }
        });
      }
    }
  });
}

/**
 * ç²¾ç»†è¿‡æ»¤å¯¼å‡ºå¯¹è±¡ï¼ˆVue ç»„ä»¶é…ç½®å¯¹è±¡ï¼‰
 * @param {Object} ast - AST å¯¹è±¡
 * @param {Set} keptNodes - ä¿ç•™çš„èŠ‚ç‚¹é›†åˆ
 * @param {Set} visitedVars - å·²è®¿é—®çš„å˜é‡é›†åˆ
 *
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 * ğŸ“ è¿™æ˜¯è¿‡æ»¤çš„æ ¸å¿ƒæ­¥éª¤
 *
 * Vue ç»„ä»¶çš„ export default { } æ˜¯ä¸€ä¸ªå¤§å¯¹è±¡ï¼ŒåŒ…å« nameã€propsã€dataã€
 * computedã€methods ç­‰å±æ€§ã€‚è¿™ä¸ªå‡½æ•°è´Ÿè´£ï¼š
 *
 * 1. åˆ é™¤æ— å…³çš„é¡¶å±‚å±æ€§ï¼ˆå¦‚ componentsã€i18nï¼‰
 * 2. å¯¹ä¿ç•™çš„å±æ€§ï¼Œæ·±å…¥å†…éƒ¨åˆ é™¤æ— å…³çš„å­é¡¹
 *
 * ğŸ“Š å¤„ç†æµç¨‹ï¼š
 *
 *   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 *   â”‚  éå† export default { } çš„æ¯ä¸ªå±æ€§                         â”‚
 *   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 *                           â”‚
 *          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 *          â–¼                â–¼                â–¼
 *   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 *   â”‚ æ— å…³å±æ€§ï¼Ÿ   â”‚  â”‚ ç›¸å…³å±æ€§ï¼Ÿ   â”‚  â”‚ name å±æ€§ï¼Ÿ â”‚
 *   â”‚ â†’ åˆ é™¤      â”‚  â”‚ â†’ æ·±åº¦è¿‡æ»¤   â”‚  â”‚ â†’ ä¿ç•™      â”‚
 *   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 */
function filterExportObject(ast, keptNodes, visitedVars) {
  traverseAST(ast, {
    ExportDefaultDeclaration(path) {
      // åªå¤„ç†è¢«ä¿ç•™çš„èŠ‚ç‚¹
      if (!keptNodes.has(path.node)) return;

      const declaration = path.get('declaration');

      // åªå¤„ç†å¯¹è±¡è¡¨è¾¾å¼ï¼ˆexport default { }ï¼‰
      if (!declaration.isObjectExpression()) return;

      // éå†å¯¹è±¡çš„æ¯ä¸ªå±æ€§
      const props = declaration.get('properties');
      props.forEach(propPath => {
        const node = propPath.node;
        const keyName = node.key?.name || '';

        // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
        // æ­¥éª¤1ï¼šåˆ¤æ–­æ˜¯å¦ä¿ç•™è¯¥å±æ€§
        // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
        if (!shouldKeepProperty(keyName, node, visitedVars)) {
          propPath.remove();
          return;
        }

        // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
        // æ­¥éª¤2ï¼šæ·±åº¦è¿‡æ»¤å±æ€§å†…éƒ¨çš„å­å±æ€§
        // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
        filterSubProperties(propPath, keyName, visitedVars);

        // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
        // æ­¥éª¤3ï¼šè¿‡æ»¤ç”Ÿå‘½å‘¨æœŸé’©å­ä¸­çš„è¯­å¥
        // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
        filterLifecycleStatements(propPath, keyName, visitedVars);

        // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
        // æ­¥éª¤4ï¼šè¿‡æ»¤ data å±æ€§
        // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
        if (keyName === 'data') {
          filterDataProperties(propPath, visitedVars);
        }
      });
    }
  });
}

/**
 * è¿‡æ»¤ import è¯­å¥
 * @param {Object} ast - AST å¯¹è±¡
 * @param {Set} keptNodes - ä¿ç•™çš„èŠ‚ç‚¹é›†åˆ
 *
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 * ğŸ“ import è¯­å¥è¿‡æ»¤è§„åˆ™
 *
 * ä¸æ˜¯æ‰€æœ‰ import éƒ½éœ€è¦ä¿ç•™ï¼Œæˆ‘ä»¬åªä¿ç•™ä¸æ•°æ®æµç›¸å…³çš„ï¼š
 *
 * â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 * â”‚  import { mapState } from 'vuex'     // âœ… ä¿ç•™ï¼ˆçŠ¶æ€ç®¡ç†ï¼‰    â”‚
 * â”‚  import request from '@/utils/request' // âœ… ä¿ç•™ï¼ˆAPI è¯·æ±‚ï¼‰ â”‚
 * â”‚  import ChartCard from './ChartCard' // âŒ åˆ é™¤ï¼ˆç»„ä»¶å¯¼å…¥ï¼‰    â”‚
 * â”‚  import lodash from 'lodash'         // âŒ åˆ é™¤ï¼ˆå·¥å…·åº“ï¼‰      â”‚
 * â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 *
 * åˆ¤æ–­è§„åˆ™ï¼šimport è·¯å¾„ä¸­åŒ…å« vuexã€requestã€apiã€store å…³é”®å­—çš„ä¿ç•™
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 */
function filterImports(ast, keptNodes) {
  // ç›´æ¥ä¿®æ”¹ AST çš„ body æ•°ç»„
  ast.program.body = ast.program.body.filter(node => {
    // å¦‚æœæ˜¯ import è¯­å¥
    if (node.type === 'ImportDeclaration') {
      // æŠŠ import è¯­å¥è½¬å›ä»£ç å­—ç¬¦ä¸²
      const code = generateCode(node);

      // æ£€æŸ¥æ˜¯å¦åŒ…å«éœ€è¦ä¿ç•™çš„å…³é”®å­—
      return PRESERVED_IMPORT_KEYWORDS.some(keyword => code.includes(keyword));
    }

    // é import è¯­å¥ï¼šæ£€æŸ¥æ˜¯å¦åœ¨ä¿ç•™é›†åˆä¸­
    return keptNodes.has(node);
  });
}

/**
 * Script ä»£ç æçº¯ä¸»å‡½æ•°
 * @param {string} code - æºä»£ç 
 * @param {Array} targetVars - ç›®æ ‡å˜é‡åˆ—è¡¨
 * @returns {string} æçº¯åçš„ä»£ç 
 *
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 * ğŸ¯ è¿™æ˜¯å¯¹å¤–æš´éœ²çš„å”¯ä¸€æ¥å£
 *
 * è¾“å…¥ï¼š2000 è¡Œçš„ Vue ç»„ä»¶ä»£ç  + ç›®æ ‡å˜é‡åˆ—è¡¨
 * è¾“å‡ºï¼š50-200 è¡Œçš„ç²¾ç®€ä»£ç 
 *
 * ğŸ“Š å¤„ç†æµç¨‹ï¼š
 *
 *   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 *   â”‚  è¾“å…¥: code = "export default { ... 2000è¡Œä»£ç  ... }"       â”‚
 *   â”‚        targetVars = ['amount']                              â”‚
 *   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 *                           â”‚
 *                           â–¼
 *   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 *   â”‚  Step 1: è§£æä»£ç ä¸º AST                                     â”‚
 *   â”‚  ä½¿ç”¨ @babel/parserï¼Œæ”¯æŒ ES6+ã€è£…é¥°å™¨ã€JSX ç­‰è¯­æ³•          â”‚
 *   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 *                           â”‚
 *                           â–¼
 *   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 *   â”‚  Step 2: BFS ä¾èµ–è¿½è¸ª                                       â”‚
 *   â”‚  ä»ç›®æ ‡å˜é‡å‡ºå‘ï¼Œæ‰¾å‡ºæ‰€æœ‰ç›¸å…³çš„ä»£ç èŠ‚ç‚¹                      â”‚
 *   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 *                           â”‚
 *                           â–¼
 *   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 *   â”‚  Step 3: ç²¾ç»†è¿‡æ»¤å¯¼å‡ºå¯¹è±¡                                   â”‚
 *   â”‚  åˆ é™¤ componentsã€i18n ç­‰æ— å…³å±æ€§                           â”‚
 *   â”‚  æ·±å…¥ propsã€computedã€methods åˆ é™¤æ— å…³å­é¡¹                 â”‚
 *   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 *                           â”‚
 *                           â–¼
 *   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 *   â”‚  Step 4: è¿‡æ»¤ import è¯­å¥                                   â”‚
 *   â”‚  åªä¿ç•™ vuexã€requestã€api ç›¸å…³çš„å¯¼å…¥                       â”‚
 *   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 *                           â”‚
 *                           â–¼
 *   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 *   â”‚  Step 5: ç”Ÿæˆä»£ç                                            â”‚
 *   â”‚  ä½¿ç”¨ @babel/generator æŠŠ AST è½¬å›ä»£ç å­—ç¬¦ä¸²                â”‚
 *   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 *                           â”‚
 *                           â–¼
 *   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 *   â”‚  è¾“å‡º: "export default { name: 'xxx', props: { amount } }"  â”‚
 *   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 *
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 */
function pruneScript(code, targetVars) {
  // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  // Step 1: è§£æä»£ç ä¸º AST
  // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  // parseCode å†…éƒ¨ä½¿ç”¨ @babel/parserï¼Œé…ç½®åœ¨ astUtils.js ä¸­
  const ast = parseCode(code);

  // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  // Step 2: BFS ä¾èµ–è¿½è¸ª
  // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  // ä»ç›®æ ‡å˜é‡å‡ºå‘ï¼Œæ‰¾å‡ºæ‰€æœ‰éœ€è¦ä¿ç•™çš„èŠ‚ç‚¹
  const { keptNodes, visitedVars } = trackDependencies(ast, targetVars);

  // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  // Step 3: ç²¾ç»†è¿‡æ»¤å¯¼å‡ºå¯¹è±¡
  // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  // æ·±å…¥ export default { } å†…éƒ¨ï¼Œåˆ é™¤æ— å…³å±æ€§å’Œå­é¡¹
  filterExportObject(ast, keptNodes, visitedVars);

  // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  // Step 4: è¿‡æ»¤ import è¯­å¥
  // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  // åªä¿ç•™ä¸æ•°æ®æµç›¸å…³çš„ import
  filterImports(ast, keptNodes);

  // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  // Step 5: ç”Ÿæˆæçº¯åçš„ä»£ç 
  // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  // generateCode å†…éƒ¨ä½¿ç”¨ @babel/generator
  return generateCode(ast);
}

// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
// æ¨¡å—å¯¼å‡º
// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

module.exports = { pruneScript };
