/**
 * pathUtils.js - è·¯å¾„å¤„ç†å·¥å…·
 *
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 * ğŸ¯ æ ¸å¿ƒåŠŸèƒ½ï¼šå¤„ç† Webpack æ¨¡å—è·¯å¾„ï¼Œå°†å„ç§æ ¼å¼çš„è·¯å¾„ç»Ÿä¸€åŒ–
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 *
 * ğŸ“š æŠ€æœ¯èƒŒæ™¯ï¼š
 *
 * Webpack æ‰“åŒ…æ—¶ï¼Œæ¨¡å—è·¯å¾„ä¼šæœ‰å¾ˆå¤š"å™ªéŸ³"ï¼Œæ¯”å¦‚ï¼š
 *
 * 1. Loader å‰ç¼€ï¼š
 *    "babel-loader!vue-loader!./src/App.vue"
 *    â†‘ è¿™äº›æ˜¯ Webpack å¤„ç†æ–‡ä»¶ç”¨çš„å·¥å…·é“¾
 *
 * 2. Query å‚æ•°ï¼š
 *    "./src/App.vue?vue&type=script&lang=js"
 *    â†‘ Vue å•æ–‡ä»¶ç»„ä»¶ä¼šè¢«æ‹†åˆ†æˆå¤šä¸ª"è™šæ‹Ÿæ¨¡å—"
 *
 * 3. è·¯å¾„åˆ«åï¼š
 *    "@/components/Button" -> "src/components/Button"
 *    â†‘ å¼€å‘æ—¶ç”¨ @ ç®€å†™ï¼Œå®é™…å¯¹åº” src ç›®å½•
 *
 * è¿™ä¸ªå·¥å…·çš„ä½œç”¨å°±æ˜¯æŠŠè¿™äº›"è„è·¯å¾„"æ¸…æ´—æˆå¹²å‡€çš„ç›¸å¯¹è·¯å¾„ã€‚
 *
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 */

const fs = require('fs');
const path = require('path');

/**
 * è·¯å¾„æ¸…æ´—å™¨ - å°† Webpack æ¨¡å—è·¯å¾„è½¬æ¢ä¸ºæ ‡å‡†çš„ç›¸å¯¹è·¯å¾„
 * @param {string} rawPath - åŸå§‹è·¯å¾„ï¼ˆå¯èƒ½åŒ…å« loader å‰ç¼€ã€query å‚æ•°ç­‰ï¼‰
 * @param {string} projectRoot - é¡¹ç›®æ ¹ç›®å½•
 * @param {Object} alias - åˆ«åé…ç½®ï¼ˆå¦‚ { '@': 'src' }ï¼‰
 * @returns {string|null} æ¸…æ´—åçš„è·¯å¾„ï¼Œå¤±è´¥è¿”å› null
 *
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 * ğŸ“Š æ¸…æ´—æµç¨‹å›¾è§£ï¼š
 *
 *   è¾“å…¥ï¼ˆè„è·¯å¾„ï¼‰:
 *   "cache-loader!babel-loader!/Users/xxx/project/src/App.vue?vue&type=script"
 *
 *   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 *   â”‚ Step 1: å»é™¤ Loader å‰ç¼€                                     â”‚
 *   â”‚ "cache-loader!babel-loader!/Users/xxx/project/src/App.vue"  â”‚
 *   â”‚                            â†“                                 â”‚
 *   â”‚ "/Users/xxx/project/src/App.vue?vue&type=script"            â”‚
 *   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 *                                â†“
 *   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 *   â”‚ Step 2: å»é™¤ Query å‚æ•°                                      â”‚
 *   â”‚ "/Users/xxx/project/src/App.vue?vue&type=script"            â”‚
 *   â”‚                            â†“                                 â”‚
 *   â”‚ "/Users/xxx/project/src/App.vue"                            â”‚
 *   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 *                                â†“
 *   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 *   â”‚ Step 3: ç»å¯¹è·¯å¾„ -> ç›¸å¯¹è·¯å¾„                                  â”‚
 *   â”‚ "/Users/xxx/project/src/App.vue"                            â”‚
 *   â”‚                            â†“                                 â”‚
 *   â”‚ "src/App.vue"                                               â”‚
 *   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 *
 *   è¾“å‡ºï¼ˆå¹²å‡€è·¯å¾„ï¼‰: "src/App.vue"
 *
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 */
function cleanPath(rawPath, projectRoot, alias = {}) {
    // å‚æ•°æ ¡éªŒ
    if (!rawPath || typeof rawPath !== 'string') return null;

    let p = rawPath;

    // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    // Step 1: å»é™¤ Loader å‰ç¼€
    // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    // ç¤ºä¾‹: "babel-loader!vue-loader!./src/App.vue" -> "./src/App.vue"
    // Loader ä¹‹é—´ç”¨ ! åˆ†éš”ï¼Œå–æœ€åä¸€ä¸ªå°±æ˜¯çœŸæ­£çš„æ–‡ä»¶è·¯å¾„
    const lastBangIndex = p.lastIndexOf('!');
    if (lastBangIndex !== -1) {
        p = p.substring(lastBangIndex + 1);
    }

    // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    // Step 2: å»é™¤ Query å‚æ•°
    // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    // ç¤ºä¾‹: "./src/App.vue?vue&type=script" -> "./src/App.vue"
    // Vue SFC ä¼šè¢« vue-loader æ‹†åˆ†æˆå¤šä¸ªè™šæ‹Ÿæ¨¡å—ï¼Œç”¨ query åŒºåˆ†
    const questionMarkIndex = p.indexOf('?');
    if (questionMarkIndex !== -1) {
        p = p.substring(0, questionMarkIndex);
    }

    // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    // Step 3: å»é™¤ ConcatenatedModule æ ‡è¯†
    // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    // ç¤ºä¾‹: "./src/utils/a.js + 2 modules" -> "./src/utils/a.js"
    // Webpack 5 åˆå¹¶æ¨¡å—æ—¶ä¼šåŠ ä¸Šè¿™ä¸ªåç¼€
    const plusIndex = p.indexOf(' + ');
    if (plusIndex !== -1) {
        p = p.substring(0, plusIndex);
    }

    // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    // Step 4: ç»Ÿä¸€è·¯å¾„åˆ†éš”ç¬¦
    // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    // Windows ç”¨ \ï¼ŒUnix ç”¨ /ï¼Œç»Ÿä¸€æˆ / (POSIX é£æ ¼)
    p = p.replace(/\\/g, '/');

    // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    // Step 5: ç»å¯¹è·¯å¾„ -> ç›¸å¯¹è·¯å¾„
    // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    // ç¤ºä¾‹: "/Users/xxx/project/src/App.vue" -> "src/App.vue"
    if (path.isAbsolute(p)) {
        p = path.relative(projectRoot, p);
        p = p.replace(/\\/g, '/');
    }

    // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    // Step 6: åˆ«åæ›¿æ¢
    // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    // ç¤ºä¾‹: "@/components/Button" -> "src/components/Button"
    for (const [key, value] of Object.entries(alias)) {
        if (p.startsWith(`${key}/`)) {
            p = p.replace(key, value);
            break;
        }
    }

    // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    // Step 7: æ ‡å‡†åŒ–è·¯å¾„å‰ç¼€
    // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    // ç¡®ä¿è·¯å¾„ä»¥ src/ å¼€å¤´ï¼Œå»é™¤å¤šä½™çš„ ../ æˆ– ./
    const srcIndex = p.indexOf('src/');
    if (srcIndex !== -1) {
        // å¦‚æœåŒ…å« src/ï¼Œä» src/ å¼€å§‹æˆªå–
        p = p.substring(srcIndex);
    } else {
        // å»é™¤å¼€å¤´çš„ ../ æˆ– ./
        while (p.startsWith('../') || p.startsWith('./')) {
            p = p.replace(/^\.\.\//, '').replace(/^\.\//, '');
        }
        // å»é™¤å¼€å¤´çš„ /
        if (p.startsWith('/')) p = p.substring(1);
    }

    return p;
}

/**
 * å°è¯•è¡¥å…¨æ–‡ä»¶åç¼€
 * @param {string} filePath - æ— åç¼€çš„ç›¸å¯¹è·¯å¾„
 * @param {string} projectRoot - é¡¹ç›®æ ¹ç›®å½•
 * @returns {string} è¡¥å…¨åç¼€åçš„è·¯å¾„ï¼Œæˆ–åŸè·¯å¾„
 *
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 * ğŸ“ ä¸ºä»€ä¹ˆéœ€è¦è¡¥å…¨åç¼€ï¼Ÿ
 *
 * åœ¨ import æ—¶å¯ä»¥çœç•¥åç¼€ï¼š
 *   import Button from './Button'     // å®é™…æ˜¯ Button.vue
 *   import utils from './utils'       // å®é™…æ˜¯ utils/index.js
 *
 * Webpack ä¼šè‡ªåŠ¨å°è¯•è¿™äº›åç¼€ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦åšåŒæ ·çš„äº‹æƒ…ã€‚
 *
 * ğŸ“Š æŸ¥æ‰¾ä¼˜å…ˆçº§ï¼š
 *   1. ç›´æ¥æ‹¼æ¥åç¼€ï¼šButton.vue, Button.js, Button.ts ...
 *   2. ç›®å½•ç´¢å¼•æ–‡ä»¶ï¼šButton/index.vue, Button/index.js ...
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 */
function tryResolveExtension(filePath, projectRoot) {
    try {
        // å¦‚æœå·²ç»æœ‰åç¼€ï¼Œç›´æ¥è¿”å›
        if (!filePath || path.extname(filePath)) return filePath;

        const absPath = path.join(projectRoot, filePath);

        // æ”¯æŒçš„æ–‡ä»¶åç¼€ï¼ˆæŒ‰ä¼˜å…ˆçº§æ’åºï¼‰
        const extensions = ['.vue', '.js', '.ts', '.jsx', '.tsx', '.json'];

        // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
        // ç­–ç•¥1ï¼šç›´æ¥æ‹¼æ¥åç¼€
        // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
        // ç¤ºä¾‹: "Button" -> "Button.vue"
        for (const ext of extensions) {
            if (fs.existsSync(absPath + ext)) {
                return filePath + ext;
            }
        }

        // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
        // ç­–ç•¥2ï¼šç›®å½•ç´¢å¼•æ–‡ä»¶
        // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
        // ç¤ºä¾‹: "components/Menu" -> "components/Menu/index.vue"
        if (fs.existsSync(absPath) && fs.statSync(absPath).isDirectory()) {
            for (const ext of extensions) {
                const indexPath = path.join(absPath, 'index' + ext);
                if (fs.existsSync(indexPath)) {
                    return path.join(filePath, 'index' + ext).replace(/\\/g, '/');
                }
            }
        }
    } catch (e) {
        // é™é»˜å¤±è´¥ï¼Œè¿”å›åŸè·¯å¾„
    }

    return filePath;
}

/**
 * è§£æç›¸å¯¹è·¯å¾„è¯·æ±‚
 * @param {string} request - å¯¼å…¥è¯·æ±‚ï¼ˆå¦‚ './ChartCard' æˆ– '@/utils/request'ï¼‰
 * @param {string} parentPath - çˆ¶æ¨¡å—è·¯å¾„
 * @param {Object} alias - åˆ«åé…ç½®
 * @returns {string} è§£æåçš„è·¯å¾„
 *
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 * ğŸ“ åŠŸèƒ½è¯´æ˜ï¼š
 *
 * å°† import è¯­å¥ä¸­çš„è·¯å¾„è§£ææˆå®Œæ•´çš„ç›¸å¯¹è·¯å¾„ã€‚
 *
 * ğŸ“Š ç¤ºä¾‹ï¼š
 *
 *   åœºæ™¯1ï¼šç›¸å¯¹è·¯å¾„
 *   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 *   â”‚ çˆ¶æ¨¡å—: "src/views/Dashboard.vue"                  â”‚
 *   â”‚ è¯·æ±‚:   "./components/ChartCard"                   â”‚
 *   â”‚ ç»“æœ:   "src/views/components/ChartCard"           â”‚
 *   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 *
 *   åœºæ™¯2ï¼šåˆ«åè·¯å¾„
 *   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 *   â”‚ è¯·æ±‚:   "@/utils/request"                          â”‚
 *   â”‚ ç»“æœ:   "src/utils/request"                        â”‚
 *   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 *
 *   åœºæ™¯3ï¼šnpm åŒ…ï¼ˆä¸å¤„ç†ï¼‰
 *   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 *   â”‚ è¯·æ±‚:   "lodash"                                   â”‚
 *   â”‚ ç»“æœ:   "lodash"ï¼ˆåŸæ ·è¿”å›ï¼‰                        â”‚
 *   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 */
function resolveRequest(request, parentPath, alias = {}) {
    let resolved = request;

    // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    // æƒ…å†µ1ï¼šåˆ«åè·¯å¾„ï¼ˆå¦‚ @/xxxï¼‰
    // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    for (const [aliasKey, aliasValue] of Object.entries(alias)) {
        if (request.startsWith(aliasKey + '/')) {
            return request.replace(aliasKey, aliasValue);
        }
    }

    // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    // æƒ…å†µ2ï¼šç›¸å¯¹è·¯å¾„ï¼ˆå¦‚ ./xxx æˆ– ../xxxï¼‰
    // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    if (request.startsWith('.')) {
        // è·å–çˆ¶æ¨¡å—æ‰€åœ¨ç›®å½•
        const parentDir = path.dirname(parentPath);
        // æ‹¼æ¥å¾—åˆ°å®Œæ•´è·¯å¾„
        resolved = path.join(parentDir, request).replace(/\\/g, '/');
    }

    return resolved;
}

/**
 * åˆ¤æ–­è·¯å¾„æ˜¯å¦ä¸ºä¸šåŠ¡ä»£ç ï¼ˆéœ€è¦è¿½è¸ªçš„ä»£ç ï¼‰
 * @param {string} filePath - æ–‡ä»¶è·¯å¾„
 * @returns {boolean} æ˜¯å¦ä¸ºä¸šåŠ¡ä»£ç 
 *
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 * ğŸ“ ä¸ºä»€ä¹ˆè¦è¿‡æ»¤ï¼Ÿ
 *
 * æˆ‘ä»¬åªå…³å¿ƒä¸šåŠ¡ä»£ç çš„ä¾èµ–å…³ç³»ï¼Œä¸éœ€è¦è¿½è¸ªï¼š
 * - node_modules ä¸­çš„ç¬¬ä¸‰æ–¹åº“ï¼ˆå¤ªå¤šäº†ï¼‰
 * - é…ç½®æ–‡ä»¶ã€æµ‹è¯•æ–‡ä»¶ç­‰
 *
 * ğŸ“Š åˆ¤æ–­è§„åˆ™ï¼š
 *   âœ… "src/views/Dashboard.vue"              -> trueï¼ˆä¸šåŠ¡ä»£ç ï¼‰
 *   âœ… "node_modules/ant-design-vue/xxx"      -> trueï¼ˆUI ç»„ä»¶åº“ï¼Œç‰¹æ®Šä¿ç•™ï¼‰
 *   âŒ "node_modules/lodash/xxx"              -> falseï¼ˆå·¥å…·åº“ï¼‰
 *   âŒ "webpack/runtime/xxx"                  -> falseï¼ˆæ„å»ºäº§ç‰©ï¼‰
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 */
function isRelevantPath(filePath) {
    // src/ ç›®å½•ä¸‹çš„éƒ½æ˜¯ä¸šåŠ¡ä»£ç 
    if (filePath.startsWith('src/')) {
        return true;
    }

    // ant-design-vue ç»„ä»¶åº“ç‰¹æ®Šå¤„ç†ï¼ˆå¯èƒ½éœ€è¦è¿½è¸ªç»„ä»¶çš„ propsï¼‰
    if (filePath.includes('node_modules/ant-design-vue')) {
        return true;
    }

    return false;
}

module.exports = {
    cleanPath,
    tryResolveExtension,
    resolveRequest,
    isRelevantPath,
};
